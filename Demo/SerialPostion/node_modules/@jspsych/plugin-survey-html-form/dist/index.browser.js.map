{"version":3,"file":"index.browser.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nconst info = <const>{\n  name: \"survey-html-form\",\n  parameters: {\n    /** HTML formatted string containing all the input elements to display. Every element has to have its own distinctive name attribute. The <form> tag must not be included and is generated by the plugin. */\n    html: {\n      type: ParameterType.HTML_STRING,\n      pretty_name: \"HTML\",\n      default: null,\n    },\n    /** HTML formatted string to display at the top of the page above all the questions. */\n    preamble: {\n      type: ParameterType.HTML_STRING,\n      pretty_name: \"Preamble\",\n      default: null,\n    },\n    /** The text that appears on the button to finish the trial. */\n    button_label: {\n      type: ParameterType.STRING,\n      pretty_name: \"Button label\",\n      default: \"Continue\",\n    },\n    /** The HTML element ID of a form field to autofocus on. */\n    autofocus: {\n      type: ParameterType.STRING,\n      pretty_name: \"Element ID to focus\",\n      default: \"\",\n    },\n    /** Retrieve the data as an array e.g. [{name: \"INPUT_NAME\", value: \"INPUT_VALUE\"}, ...] instead of an object e.g. {INPUT_NAME: INPUT_VALUE, ...}. */\n    dataAsArray: {\n      type: ParameterType.BOOL,\n      pretty_name: \"Data As Array\",\n      default: false,\n    },\n    /** Setting this to true will enable browser auto-complete or auto-fill for the form. */\n    autocomplete: {\n      type: ParameterType.BOOL,\n      pretty_name: \"Allow autocomplete\",\n      default: false,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * **survey-html-form**\n *\n * jsPsych plugin for displaying free HTML forms and collecting responses from all input elements\n *\n * @author Jan Simson\n * @see {@link https://www.jspsych.org/plugins/jspsych-survey-html-form/ survey-html-form plugin documentation on jspsych.org}\n */\nclass SurveyHtmlFormPlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    var html = \"\";\n    // show preamble text\n    if (trial.preamble !== null) {\n      html +=\n        '<div id=\"jspsych-survey-html-form-preamble\" class=\"jspsych-survey-html-form-preamble\">' +\n        trial.preamble +\n        \"</div>\";\n    }\n    // start form\n    if (trial.autocomplete) {\n      html += '<form id=\"jspsych-survey-html-form\">';\n    } else {\n      html += '<form id=\"jspsych-survey-html-form\" autocomplete=\"off\">';\n    }\n\n    // add form HTML / input elements\n    html += trial.html;\n\n    // add submit button\n    html +=\n      '<input type=\"submit\" id=\"jspsych-survey-html-form-next\" class=\"jspsych-btn jspsych-survey-html-form\" value=\"' +\n      trial.button_label +\n      '\"></input>';\n\n    html += \"</form>\";\n    display_element.innerHTML = html;\n\n    if (trial.autofocus !== \"\") {\n      var focus_elements = display_element.querySelectorAll<HTMLInputElement>(\n        \"#\" + trial.autofocus\n      );\n      if (focus_elements.length === 0) {\n        console.warn(\"No element found with id: \" + trial.autofocus);\n      } else if (focus_elements.length > 1) {\n        console.warn('The id \"' + trial.autofocus + '\" is not unique so autofocus will not work.');\n      } else {\n        focus_elements[0].focus();\n      }\n    }\n\n    display_element\n      .querySelector(\"#jspsych-survey-html-form\")\n      .addEventListener(\"submit\", (event) => {\n        // don't submit form\n        event.preventDefault();\n\n        // measure response time\n        var endTime = performance.now();\n        var response_time = Math.round(endTime - startTime);\n\n        var this_form = display_element.querySelector(\"#jspsych-survey-html-form\");\n        var question_data = serializeArray(this_form);\n\n        if (!trial.dataAsArray) {\n          question_data = objectifyForm(question_data);\n        }\n\n        // save data\n        var trialdata = {\n          rt: response_time,\n          response: question_data,\n        };\n\n        display_element.innerHTML = \"\";\n\n        // next trial\n        this.jsPsych.finishTrial(trialdata);\n      });\n\n    var startTime = performance.now();\n\n    /**\n     * Serialize all form data into an array\n     * @copyright (c) 2018 Chris Ferdinandi, MIT License, https://gomakethings.com\n     * @param  {Node}   form The form to serialize\n     * @return {String}      The serialized form data\n     */\n    function serializeArray(form) {\n      // Setup our serialized data\n      var serialized = [];\n\n      // Loop through each field in the form\n      for (var i = 0; i < form.elements.length; i++) {\n        var field = form.elements[i];\n\n        // Don't serialize fields without a name, submits, buttons, file and reset inputs, and disabled fields\n        if (\n          !field.name ||\n          field.disabled ||\n          field.type === \"file\" ||\n          field.type === \"reset\" ||\n          field.type === \"submit\" ||\n          field.type === \"button\"\n        )\n          continue;\n\n        // If a multi-select, get all selections\n        if (field.type === \"select-multiple\") {\n          for (var n = 0; n < field.options.length; n++) {\n            if (!field.options[n].selected) continue;\n            serialized.push({\n              name: field.name,\n              value: field.options[n].value,\n            });\n          }\n        }\n\n        // Convert field data to a query string\n        else if ((field.type !== \"checkbox\" && field.type !== \"radio\") || field.checked) {\n          serialized.push({\n            name: field.name,\n            value: field.value,\n          });\n        }\n      }\n\n      return serialized;\n    }\n\n    // from https://stackoverflow.com/questions/1184624/convert-form-data-to-javascript-object-with-jquery\n    function objectifyForm(formArray) {\n      //serialize data function\n      var returnArray = <any>{};\n      for (var i = 0; i < formArray.length; i++) {\n        returnArray[formArray[i][\"name\"]] = formArray[i][\"value\"];\n      }\n      return returnArray;\n    }\n  }\n}\n\nexport default SurveyHtmlFormPlugin;\n"],"names":["ParameterType"],"mappings":"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"}