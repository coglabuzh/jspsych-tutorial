var jsPsychPreload=function(e){"use strict";function r(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var t={name:"preload",parameters:{auto_preload:{type:e.ParameterType.BOOL,pretty_name:"Auto-preload",default:!1},trials:{type:e.ParameterType.TIMELINE,pretty_name:"Trials",default:[]},images:{type:e.ParameterType.STRING,pretty_name:"Images",default:[],array:!0},audio:{type:e.ParameterType.STRING,pretty_name:"Audio",default:[],array:!0},video:{type:e.ParameterType.STRING,pretty_name:"Video",default:[],array:!0},message:{type:e.ParameterType.HTML_STRING,pretty_name:"Message",default:null},show_progress_bar:{type:e.ParameterType.BOOL,pretty_name:"Show progress bar",default:!0},continue_after_error:{type:e.ParameterType.BOOL,pretty_name:"Continue after error",default:!1},error_message:{type:e.ParameterType.HTML_STRING,pretty_name:"Error message",default:"The experiment failed to load."},show_detailed_errors:{type:e.ParameterType.BOOL,pretty_name:"Show detailed errors",default:!1},max_load_time:{type:e.ParameterType.INT,pretty_name:"Max load time",default:null},on_error:{type:e.ParameterType.FUNCTION,pretty_name:"On error",default:null},on_success:{type:e.ParameterType.FUNCTION,pretty_name:"On success",default:null}}},a=function(){function e(r){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=r}var t,a,o;return t=e,(a=[{key:"trial",value:function(e,r){var t=this,a=null,o=!1,s=[],i=[],n=[],l=[],u=this.jsPsych.getSafeModeStatus(),c=[],d=[],p=[];if(r.auto_preload){var y=this.jsPsych.getTimeline(),h=this.jsPsych.pluginAPI.getAutoPreloadList(y);c=c.concat(h.images),d=d.concat(h.audio),p=p.concat(h.video)}if(r.trials.length>0){var m=this.jsPsych.pluginAPI.getAutoPreloadList(r.trials);c=c.concat(m.images),d=d.concat(m.audio),p=p.concat(m.video)}c=c.concat(r.images),d=d.concat(r.audio),p=p.concat(r.video),c=this.jsPsych.utils.unique(c.flat()),d=this.jsPsych.utils.unique(d.flat()),p=this.jsPsych.utils.unique(p.flat()),u&&(p=[]);var f="";null!==r.message&&(f+=r.message),r.show_progress_bar&&(f+="\n            <div id='jspsych-loading-progress-bar-container' style='height: 10px; width: 300px; background-color: #ddd; margin: auto;'>\n              <div id='jspsych-loading-progress-bar' style='height: 10px; width: 0%; background-color: #777;'></div>\n            </div>"),e.innerHTML=f;var g=function(){if(j++,r.show_progress_bar){var t=j/b*100,a=e.querySelector("#jspsych-loading-progress-bar");null!==a&&(a.style.width=t+"%")}},_=function(){void 0!==o&&!1===o&&(t.jsPsych.pluginAPI.clearAllTimeouts(),t.jsPsych.pluginAPI.cancelPreloads(),a=!0,T())},P=function(){t.jsPsych.pluginAPI.clearAllTimeouts(),t.jsPsych.pluginAPI.cancelPreloads(),e.innerHTML=r.error_message,r.show_detailed_errors&&(e.innerHTML+="<p><strong>Error details:</strong></p>",l.forEach((function(r){e.innerHTML+=r})))},T=function(){t.jsPsych.pluginAPI.clearAllTimeouts();var r={success:a,timeout:o,failed_images:s,failed_audio:i,failed_video:n};e.innerHTML="",t.jsPsych.finishTrial(r)};null!==r.max_load_time&&this.jsPsych.pluginAPI.setTimeout((function(){t.jsPsych.pluginAPI.cancelPreloads(),void 0===a||!1!==a&&null!==a||(o=!0,I<b&&(a=!1),L("timeout"),l.push("<p><strong>Loading timed out.</strong><br>Consider compressing your stimuli files, loading your files in smaller batches,<br>and/or increasing the <i>max_load_time</i> parameter.</p>"),r.continue_after_error?T():P())}),r.max_load_time);var v,b=c.length+d.length+p.length,j=0,I=0;function A(e){g(),null==a&&(a=!1);var t="unknown file";e.source&&(t=e.source),e.error&&e.error.path&&e.error.path.length>0&&("img"==e.error.path[0].localName?s.push(t):"audio"==e.error.path[0].localName?i.push(t):"video"==e.error.path[0].localName&&n.push(t));var o="<p><strong>Error loading file: "+t+"</strong><br>";e.error.statusText&&(o+="File request response status: "+e.error.statusText+"<br>"),"404"==e.error&&(o+="404 - file not found.<br>"),void 0!==e.error.loaded&&null!==e.error.loaded&&0!==e.error.loaded?o+=e.error.loaded+" bytes transferred.":o+="File did not begin loading. Check that file path is correct and reachable by the browser,<br>and that loading is not blocked by cross-origin resource sharing (CORS) errors.",o+="</p>",l.push(o),L(t),j==b&&(r.continue_after_error?T():P())}function w(e){g(),function(e){null!==r.on_success&&r.on_success(e)}(e),++I==b?_():j==b&&(r.continue_after_error?T():P())}function L(e){null!==r.on_error&&r.on_error(e)}0==b?_():(p.length>0&&(v=function(){},t.jsPsych.pluginAPI.preloadVideo(p,v,w,A)),d.length>0&&function(e){t.jsPsych.pluginAPI.preloadAudio(d,e,w,A)}((function(){})),c.length>0&&function(e){t.jsPsych.pluginAPI.preloadImages(c,e,w,A)}((function(){})))}},{key:"simulate",value:function(e,r,t,a){"data-only"==r&&(a(),this.simulate_data_only(e,t)),"visual"==r&&this.simulate_visual(e,t,a)}},{key:"create_simulation_data",value:function(e,r){return this.jsPsych.pluginAPI.mergeSimulationData({success:!0,timeout:!1,failed_images:[],failed_audio:[],failed_video:[]},r)}},{key:"simulate_data_only",value:function(e,r){var t=this.create_simulation_data(e,r);this.jsPsych.finishTrial(t)}},{key:"simulate_visual",value:function(e,r,t){var a=this.jsPsych.getDisplayElement();this.trial(a,e),t()}}])&&r(t.prototype,a),o&&r(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();return a.info=t,a}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
